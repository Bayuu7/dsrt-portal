<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="DSRT Portal - Secure Modular Runtime v2" />
  <title>DSRT Portal</title>

  <!-- Base styling -->
  <link rel="stylesheet" href="assets/styles.css" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="assets/icon.png" />

  <!-- Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(console.error);
    }
  </script>

  <!-- DSRT Config (must be loaded first) -->
  <script>
    window.DSRT_CONFIG = {
      ENV: 'production',
      PREFIX: 'DSRT',
      COOKIE_TTL_DAYS: 180,
      ANALYTICS_ENDPOINT: 'http://localhost:4000/collect',
      TOKEN_ENDPOINT: 'http://localhost:4000/token',
      CATALOG_URL: '/config/games.json',
      PORTAL_NAME: 'DSRT Portal',
      CONSENT_KEY: 'DSRT_consent_v2',
      BATCH_MAX: 12,
      BATCH_INTERVAL_MS: 5000,
      BATCH_RETRY_LIMIT: 5,
      BATCH_RETRY_BASE_MS: 1000,
      DEBUG: true,
      SENTRY_DSN: '' // isi di production
    };
  </script>
</head>

<body>
  <main id="app">
    <h1>DSRT Portal</h1>
    <p>Status: <span id="dsrt-status">Initializing...</span></p>

    <button id="test-analytics">Send Test Event</button>

    <pre id="dsrt-log"></pre>
  </main>

  <!-- Core DSRT scripts -->
  <script src="scripts/core/dsrt-config.js"></script>
  <script src="scripts/core/dsrt-session.js"></script>
  <script src="scripts/core/dsrt-consent.js"></script>
  <script src="scripts/core/dsrt-analytics.js"></script>
  <script src="scripts/core/dsrt-runtime.js"></script>

  <!-- Inline test helper -->
  <script>
    const logEl = document.getElementById('dsrt-log');
    const statusEl = document.getElementById('dsrt-status');

    statusEl.textContent = 'Ready (connected to Collector)';
    logEl.textContent = '‚úÖ DSRT Portal initialized.\n';

    document.getElementById('test-analytics').onclick = async () => {
      if (window.DSRT_Analytics) {
        DSRT_Analytics.enqueue({
          type: 'test_event',
          source: 'manual_click',
          ts: Date.now()
        });
        logEl.textContent += 'üì° Sent test_event to collector.\n';
      } else {
        logEl.textContent += '‚ö†Ô∏è Analytics module not loaded.\n';
      }
    };
  </script>
</body>
</html>
